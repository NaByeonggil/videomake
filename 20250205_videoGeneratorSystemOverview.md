# 🎬 로컬 AI 동영상 생성 시스템 완전 가이드

> **RTX 3080 Ti 12GB 최적화**
> 
> ComfyUI + AnimateDiff + 웹 기반 통합 시스템
> 
> Text-to-Video + Image-to-Video + 이어붙이기 + 업스케일링

---

## 📌 목차

### Part 1: ComfyUI + AnimateDiff 기술 스펙
1. [추천 조합 개요](#1-추천-조합-개요)
2. [시스템 아키텍처](#2-시스템-아키텍처)
3. [핵심 모델 아키텍처](#3-핵심-모델-아키텍처)
4. [VRAM 사용량 분석](#4-vram-사용량-분석)
5. [노드 파이프라인 구조](#5-노드-파이프라인-구조)
6. [영상 이어붙이기](#6-영상-이어붙이기)
7. [업스케일링](#7-업스케일링)
8. [프레임 보간](#8-프레임-보간)

### Part 2: 웹 기반 통합 시스템
9. [명명 규칙](#9-명명-규칙)
10. [웹 시스템 아키텍처](#10-웹-시스템-아키텍처)
11. [기술 스택](#11-기술-스택)
12. [데이터베이스 스키마](#12-데이터베이스-스키마)
13. [API 설계](#13-api-설계)
14. [파일 저장 구조](#14-파일-저장-구조)
15. [데이터 흐름](#15-데이터-흐름)
16. [디렉토리 구조](#16-디렉토리-구조)
17. [Docker 구성](#17-docker-구성)
18. [설치 가이드](#18-설치-가이드)
19. [모델 다운로드 링크](#19-모델-다운로드-링크)
20. [구현 우선순위](#20-구현-우선순위)

---

# Part 1: ComfyUI + AnimateDiff 기술 스펙

---

## 1. 추천 조합 개요

### 왜 ComfyUI + AnimateDiff인가?

| 기능 | 지원 방식 |
|------|----------|
| **Text-to-Video** | AnimateDiff + SD1.5/SDXL 모델 |
| **Image-to-Video** | AnimateDiff + IPAdapter 또는 SVD 노드 |
| **VRAM 사용** | ~8-10GB (12GB에 여유 있음) |
| **Web UI** | 기본 내장 (localhost:8188) |

### 대안 비교

| 조합 | 장점 | VRAM 사용 | 난이도 |
|------|------|-----------|--------|
| **ComfyUI + AnimateDiff** | 텍스트+이미지 모두 지원, 커스터마이징 최고 | ~10GB | 중 |
| **ComfyUI + SVD** | 이미지→동영상 품질 우수 | ~8-10GB | 중 |
| **CogVideoX-2B** | 최신 모델, 텍스트→동영상 강력 | ~11GB | 상 |
| **Wan2.1 (1.3B)** | 알리바바 최신, 빠른 생성 | ~10GB | 중 |

---

## 2. 시스템 아키텍처

### 전체 비디오 생성 파이프라인

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        전체 비디오 생성 파이프라인                         │
└─────────────────────────────────────────────────────────────────────────┘

  ┌─────────────┐     ┌─────────────┐     ┌─────────────┐
  │ 클립 1 생성  │     │ 클립 2 생성  │     │ 클립 3 생성  │
  │ (2-4초)     │     │ (2-4초)     │     │ (2-4초)     │
  └──────┬──────┘     └──────┬──────┘     └──────┬──────┘
         │                   │                   │
         └───────────────────┼───────────────────┘
                             │
                             ▼
              ┌──────────────────────────────┐
              │     Phase 1: 영상 이어붙이기   │
              │     (Video Concatenation)    │
              └──────────────┬───────────────┘
                             │
                             ▼
              ┌──────────────────────────────┐
              │     Phase 2: 업스케일링       │
              │     512×512 → 2048×2048     │
              └──────────────┬───────────────┘
                             │
                             ▼
              ┌──────────────────────────────┐
              │     Phase 3: 프레임 보간      │
              │     8fps → 24fps            │
              └──────────────┬───────────────┘
                             │
                             ▼
                     📹 최종 OUTPUT.mp4
```

### 기본 구조

```
┌─────────────────────────────────────────────────────────────────┐
│                        사용자 브라우저                            │
│                    (localhost:8188)                              │
└─────────────────────┬───────────────────────────────────────────┘
                      │ HTTP
┌─────────────────────▼───────────────────────────────────────────┐
│                      ComfyUI 웹 서버                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 텍스트 입력  │  │ 이미지 업로드 │  │ 파라미터 설정 │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
┌─────────▼────────────────▼────────────────▼─────────────────────┐
│                    ComfyUI 노드 파이프라인                        │
│  ┌──────────────┐    ┌──────────────┐    ┌──────────────┐       │
│  │ CLIP 텍스트   │───▶│ AnimateDiff  │───▶│ VAE 디코더   │       │
│  │ 인코더       │    │ 모션 모듈     │    │              │       │
│  └──────────────┘    └──────────────┘    └──────────────┘       │
└─────────────────────────────────────────────────────────────────┘
                              │
┌─────────────────────────────▼───────────────────────────────────┐
│                     RTX 3080 Ti 12GB                            │
│        CUDA 연산 (FP16 최적화, ~8-10GB VRAM 사용)                │
└─────────────────────────────────────────────────────────────────┘
```

---

## 3. 핵심 모델 아키텍처

### 3.1 AnimateDiff 모션 모듈 구조

```
┌─────────────────────────────────────────────────────────────────────┐
│                    AnimateDiff Motion Module                        │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  기존 SD U-Net                    AnimateDiff 확장                  │
│  ┌─────────────┐                 ┌─────────────────────┐           │
│  │ Spatial     │                 │ Temporal            │           │
│  │ Self-Attn   │ ──── 삽입 ────▶ │ Self-Attention      │           │
│  │ (2D)        │                 │ (프레임 간 연결)      │           │
│  └─────────────┘                 └─────────────────────┘           │
│                                                                     │
│  원리: 각 U-Net 블록 뒤에 Temporal Transformer 레이어 추가           │
│        프레임 간 시간적 일관성(temporal coherence) 학습              │
│                                                                     │
│  파라미터 수: ~400M (모션 모듈만)                                    │
│  학습 데이터: WebVid-10M (1000만 개 비디오 클립)                     │
└─────────────────────────────────────────────────────────────────────┘
```

### 모션 모듈 버전 비교

| 모델 | 파일명 | 특성 | VRAM | 권장 용도 |
|------|--------|------|------|----------|
| **v2** | `mm_sd_v15_v2.ckpt` | 안정적, 범용 | ~1.5GB | 일반 영상 |
| **v3** | `mm_sd_v15_v3.ckpt` | 향상된 모션 | ~1.5GB | 역동적 장면 |
| **SDXL** | `mm_sdxl_v10.ckpt` | 고해상도 | ~3GB | 고품질 필요시 |
| **HS** | `mm_sd_v15_hs.ckpt` | HotShot 호환 | ~1.5GB | 짧은 GIF |

### 3.2 Stable Diffusion 1.5 아키텍처

```
┌──────────────────────────────────────────────────────────────┐
│  Stable Diffusion 1.5 Architecture                          │
├──────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌──────────┐    ┌──────────┐    ┌──────────┐               │
│  │ VAE      │    │ U-Net    │    │ CLIP     │               │
│  │ Encoder  │    │          │    │ Text     │               │
│  │ /Decoder │    │ 860M     │    │ Encoder  │               │
│  │ 84M      │    │ params   │    │ 123M     │               │
│  └──────────┘    └──────────┘    └──────────┘               │
│                                                              │
│  입력 해상도: 512×512 (기본), 768×768 (확장)                 │
│  잠재 공간: 64×64×4 (8배 다운샘플링)                         │
│  정밀도: FP16 권장 (VRAM 절반)                               │
└──────────────────────────────────────────────────────────────┘
```

### 추천 체크포인트 (AnimateDiff 호환)

| 체크포인트 | 스타일 | 용량 | 다운로드 소스 |
|-----------|--------|------|--------------|
| **RealisticVision v5.1** | 실사 | 2.1GB | CivitAI |
| **DreamShaper v8** | 범용/아트 | 2.1GB | CivitAI |
| **ToonYou Beta6** | 애니메이션 | 2.1GB | CivitAI |
| **epiCRealism** | 실사 고품질 | 2.1GB | CivitAI |

### 3.3 IPAdapter 아키텍처 (Image-to-Video 핵심)

```
┌─────────────────────────────────────────────────────────────────────┐
│                    IPAdapter Architecture                           │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│   입력 이미지                                                        │
│       │                                                             │
│       ▼                                                             │
│  ┌─────────────────┐                                                │
│  │ CLIP Image      │  ← OpenCLIP ViT-H/14 (632M params)            │
│  │ Encoder         │    출력: 257 tokens × 1280 dim                 │
│  └────────┬────────┘                                                │
│           │                                                         │
│           ▼                                                         │
│  ┌─────────────────┐                                                │
│  │ Projection      │  ← 이미지 특징 → 텍스트 임베딩 공간 변환        │
│  │ Layer           │    (학습된 어댑터)                              │
│  └────────┬────────┘                                                │
│           │                                                         │
│           ▼                                                         │
│  ┌─────────────────┐                                                │
│  │ Cross-Attention │  ← U-Net의 Cross-Attn에 주입                   │
│  │ Injection       │    weight 파라미터로 강도 조절 (0.0~1.0)       │
│  └─────────────────┘                                                │
└─────────────────────────────────────────────────────────────────────┘
```

### IPAdapter 모델 버전

| 모델 | 용도 | VRAM 추가 | 특징 |
|------|------|----------|------|
| **ip-adapter_sd15** | 기본 | +1GB | 스타일 전이 |
| **ip-adapter-plus_sd15** | 향상 | +1.2GB | 더 정확한 참조 |
| **ip-adapter-faceid** | 얼굴 | +1.5GB | 얼굴 일관성 유지 |

---

## 4. VRAM 사용량 분석

### 4.1 컴포넌트별 VRAM 점유

```
┌─────────────────────────────────────────────────────────────┐
│          RTX 3080 Ti 12GB VRAM 할당 계획                    │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ■■■■■■■■░░░░  SD 1.5 U-Net (FP16)         ~3.4 GB         │
│  ■■░░░░░░░░░░  AnimateDiff Motion Module  ~1.5 GB         │
│  ■■░░░░░░░░░░  IPAdapter + CLIP Image     ~1.2 GB         │
│  ■░░░░░░░░░░░  VAE Decoder                ~0.3 GB         │
│  ■░░░░░░░░░░░  CLIP Text Encoder          ~0.5 GB         │
│  ■■■░░░░░░░░░  작업 메모리 (16프레임)      ~2.5 GB         │
│  ───────────────────────────────────────────────           │
│  합계                                      ~9.4 GB         │
│  여유                                      ~2.6 GB         │
└─────────────────────────────────────────────────────────────┘
```

### 4.2 해상도별 VRAM 사용량

| 해상도 | 프레임 수 | 예상 VRAM | 3080 Ti 가능 여부 |
|--------|----------|----------|------------------|
| 512×512 | 16 | ~8GB | ✅ 여유 |
| 512×512 | 32 | ~10GB | ✅ 가능 |
| 768×768 | 16 | ~11GB | ⚠️ 타이트 |
| 768×768 | 24 | ~12GB+ | ❌ OOM 위험 |

### 4.3 전체 파이프라인 VRAM (후처리 포함)

```
┌─────────────────────────────────────────────────────────────────────┐
│           RTX 3080 Ti 12GB - 전체 파이프라인 VRAM                   │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  === 생성 단계 (순차 실행) ===                                       │
│  ■■■■■■■■■░░░  AnimateDiff 생성           ~9.4 GB                  │
│                                                                     │
│  === 후처리 단계 (생성 후 모델 언로드) ===                            │
│  ■■░░░░░░░░░░  Real-ESRGAN 업스케일       ~2 GB                    │
│  ■■░░░░░░░░░░  RIFE 프레임 보간           ~2 GB                    │
│  ■░░░░░░░░░░░  FFmpeg 인코딩              ~0.5 GB (CPU)            │
│                                                                     │
│  ✅ 순차 실행으로 12GB 내 처리 가능                                  │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 5. 노드 파이프라인 구조

### 5.1 Text-to-Video 워크플로우

```
┌─────────────────────────────────────────────────────────────────────────┐
│                     Text-to-Video Pipeline                              │
└─────────────────────────────────────────────────────────────────────────┘

[Load Checkpoint] ──────────────────────────────────────┐
       │                                                │
       ├──▶ MODEL ──▶ [AnimateDiff Loader] ──▶ MODEL+Motion
       │                      │
       ├──▶ CLIP ───┐        │
       │            │        │
       └──▶ VAE ────┼────────┼─────────────────────────┐
                    │        │                         │
                    ▼        │                         │
[CLIP Text Encode] ◀────────┘                         │
  │ (Positive)                                         │
  │                                                    │
  ├──▶ CONDITIONING ──┐                               │
  │                   │                               │
[CLIP Text Encode]    │                               │
  │ (Negative)        │                               │
  │                   │                               │
  └──▶ CONDITIONING ──┼───────────────────┐           │
                      │                   │           │
                      ▼                   ▼           │
              [KSampler (AnimateDiff)]                │
                      │                               │
                      │  steps: 20-25                 │
                      │  cfg: 7.5                     │
                      │  sampler: euler_ancestral     │
                      │  scheduler: normal            │
                      │                               │
                      ▼                               │
                   LATENT                             │
                      │                               │
                      ▼                               ▼
              [VAE Decode] ◀──────────────────────────┘
                      │
                      ▼
                   IMAGE (batch of frames)
                      │
                      ▼
              [Video Combine]
                      │
                      │  frame_rate: 8
                      │  format: video/h264-mp4
                      │
                      ▼
                 📹 OUTPUT.mp4
```

### 5.2 Image-to-Video 워크플로우

```
┌─────────────────────────────────────────────────────────────────────────┐
│                    Image-to-Video Pipeline                              │
└─────────────────────────────────────────────────────────────────────────┘

[Load Image] ──────────────────────────────────────────┐
       │                                               │
       ▼                                               │
[IPAdapter Encoder]                                    │
       │                                               │
       ├──▶ IMAGE_EMBEDS                              │
       │                                               │
       ▼                                               │
[Load Checkpoint] ─────┐                              │
       │               │                              │
       ├──▶ MODEL ─────┼──▶ [IPAdapter Apply] ◀───────┘
       │               │           │
       │               │           │  weight: 0.8
       │               │           │  (이미지 참조 강도)
       │               │           │
       │               │           ▼
       │               │    MODEL (IP-adapted)
       │               │           │
       ├──▶ CLIP ──────┼───────────┼──▶ [AnimateDiff Loader]
       │               │           │           │
       └──▶ VAE ───────┼───────────┼───────────┼─────────────┐
                       │           │           │             │
                       ▼           ▼           ▼             │
              [CLIP Text Encode]   │    MODEL+Motion         │
                (모션 프롬프트)     │           │             │
                       │           │           │             │
                       ▼           │           │             │
                CONDITIONING ──────┴───────────┘             │
                       │                                     │
                       ▼                                     │
               [KSampler] ◀──────────────────────────────────┘
                       │
                       ▼
                   LATENT → [VAE Decode] → [Video Combine]
                                                │
                                                ▼
                                           📹 OUTPUT.mp4
```

### 5.3 주요 파라미터

#### KSampler 설정

| 파라미터 | 권장값 | 범위 | 설명 |
|---------|--------|------|------|
| **steps** | 20-25 | 10-50 | 디노이징 단계 (높을수록 품질↑, 속도↓) |
| **cfg** | 7.0-8.0 | 1-20 | 프롬프트 따름 강도 |
| **sampler** | euler_ancestral | - | AnimateDiff에 최적 |
| **scheduler** | normal | - | 노이즈 스케줄 |
| **denoise** | 1.0 | 0-1 | 초기 생성시 1.0 |

#### AnimateDiff 설정

| 파라미터 | 권장값 | 설명 |
|---------|--------|------|
| **context_length** | 16 | 한 번에 처리할 프레임 수 |
| **context_overlap** | 4 | 컨텍스트 간 중첩 (연속성) |
| **context_schedule** | uniform | 프레임 샘플링 방식 |
| **beta_schedule** | sqrt_linear | 노이즈 스케줄 |

#### IPAdapter 설정

| 파라미터 | 권장값 | 설명 |
|---------|--------|------|
| **weight** | 0.7-0.9 | 이미지 참조 강도 |
| **weight_type** | linear | 가중치 적용 방식 |
| **start_at** | 0.0 | 적용 시작 지점 |
| **end_at** | 1.0 | 적용 종료 지점 |

---

## 6. 영상 이어붙이기

### 6.1 방법 A: ComfyUI 내장 (VideoHelperSuite)

```
┌─────────────────────────────────────────────────────────────────────┐
│                  ComfyUI 영상 병합 노드 구조                         │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  [Load Video 1] ──▶ IMAGES ──┐                                     │
│                              │                                     │
│  [Load Video 2] ──▶ IMAGES ──┼──▶ [Batch Images] ──▶ IMAGES       │
│                              │           │                         │
│  [Load Video 3] ──▶ IMAGES ──┘           │                         │
│                                          ▼                         │
│                              ┌─────────────────────┐               │
│                              │   Video Combine     │               │
│                              │   frame_rate: 8     │               │
│                              │   format: h264-mp4  │               │
│                              └──────────┬──────────┘               │
│                                         │                          │
│                                         ▼                          │
│                                   📹 merged.mp4                    │
└─────────────────────────────────────────────────────────────────────┘
```

### 6.2 방법 B: FFmpeg 직접 사용 (더 빠름)

```bash
# 영상 목록 파일 생성
echo "file 'clip1.mp4'" > list.txt
echo "file 'clip2.mp4'" >> list.txt
echo "file 'clip3.mp4'" >> list.txt

# 무손실 이어붙이기
ffmpeg -f concat -safe 0 -i list.txt -c copy merged.mp4

# 트랜지션 포함 (크로스페이드 0.5초)
ffmpeg -i clip1.mp4 -i clip2.mp4 -filter_complex \
  "[0][1]xfade=transition=fade:duration=0.5:offset=2" \
  -c:v libx264 merged_fade.mp4
```

### 6.3 트랜지션 옵션

| 트랜지션 | 설명 | FFmpeg 파라미터 |
|---------|------|----------------|
| **fade** | 페이드 인/아웃 | `transition=fade` |
| **wipeleft** | 좌측 와이프 | `transition=wipeleft` |
| **slideup** | 위로 슬라이드 | `transition=slideup` |
| **dissolve** | 디졸브 | `transition=dissolve` |
| **none** | 컷 편집 | `-c copy` |

---

## 7. 업스케일링

### 7.1 옵션별 비교

| 방법 | 배율 | VRAM | 품질 | 속도 | 권장 용도 |
|------|------|------|------|------|----------|
| **Real-ESRGAN** | 2x/4x | ~2GB | ⭐⭐⭐⭐ | 빠름 | 실사 영상 |
| **ESRGAN (애니)** | 4x | ~2GB | ⭐⭐⭐⭐ | 빠름 | 애니메이션 |
| **AnimateDiff Upscale** | 2x | ~10GB | ⭐⭐⭐⭐⭐ | 느림 | 최고 품질 |
| **Topaz Video AI** | 2x/4x | ~4GB | ⭐⭐⭐⭐⭐ | 중간 | 상업용 (유료) |
| **Bicubic** | Any | CPU | ⭐⭐ | 즉시 | 테스트용 |

### 7.2 Real-ESRGAN 아키텍처

```
┌─────────────────────────────────────────────────────────────────────┐
│                    Real-ESRGAN Video Upscaling                      │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│   입력 비디오 (512×512)                                              │
│         │                                                           │
│         ▼                                                           │
│   ┌─────────────────┐                                               │
│   │ 프레임 추출      │  FFmpeg: -i input.mp4 frames/%04d.png        │
│   │ (PNG 시퀀스)    │                                               │
│   └────────┬────────┘                                               │
│            │                                                        │
│            ▼                                                        │
│   ┌─────────────────────────────────────────────────┐              │
│   │           Real-ESRGAN 모델                       │              │
│   │                                                  │              │
│   │   ┌─────────────┐    ┌─────────────┐           │              │
│   │   │ RRDB Block  │ ×23│ Upsampler   │           │              │
│   │   │ (잔차 학습)  │────▶│ (PixelShuffle)│          │              │
│   │   └─────────────┘    └─────────────┘           │              │
│   │                                                  │              │
│   │   모델: RealESRGAN_x4plus.pth (64MB)            │              │
│   │   입력: 512×512 → 출력: 2048×2048               │              │
│   └────────────────────┬────────────────────────────┘              │
│                        │                                            │
│                        ▼                                            │
│   ┌─────────────────┐                                               │
│   │ 프레임 병합      │  FFmpeg: -i frames/%04d.png output.mp4       │
│   │ (비디오 인코딩)  │                                               │
│   └─────────────────┘                                               │
└─────────────────────────────────────────────────────────────────────┘
```

### 7.3 Real-ESRGAN 모델 종류

| 모델 | 용도 | 배율 | 파일명 |
|------|------|------|--------|
| **RealESRGAN_x4plus** | 실사 일반 | 4x | `RealESRGAN_x4plus.pth` |
| **RealESRGAN_x4plus_anime_6B** | 애니메이션 | 4x | `RealESRGAN_x4plus_anime_6B.pth` |
| **RealESRGAN_x2plus** | 실사 2배 | 2x | `RealESRGAN_x2plus.pth` |
| **realesr-animevideov3** | 애니 비디오 특화 | 4x | `realesr-animevideov3.pth` |

### 7.4 ComfyUI 통합 업스케일 파이프라인

```
┌─────────────────────────────────────────────────────────────────────┐
│              ComfyUI 업스케일 워크플로우 (2-Pass)                    │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ===== Pass 1: 기본 업스케일 (Real-ESRGAN) =====                    │
│                                                                     │
│  [Load Video] ──▶ IMAGES                                           │
│                      │                                              │
│                      ▼                                              │
│  [Load Upscale Model] ──▶ [ImageUpscaleWithModel]                  │
│    │                              │                                 │
│    │  model: RealESRGAN_x4       │                                 │
│    │                              ▼                                 │
│    └────────────────────────▶ IMAGES (2048×2048)                   │
│                                   │                                 │
│  ===== Pass 2: AI 향상 (선택적) =====                               │
│                                   │                                 │
│                                   ▼                                 │
│  [VAE Encode] ◀────────────── IMAGES                               │
│       │                                                             │
│       ▼                                                             │
│    LATENT                                                           │
│       │                                                             │
│       ▼                                                             │
│  [KSampler] ◀── denoise: 0.3 (디테일만 추가)                        │
│       │         steps: 10                                           │
│       │         cfg: 5                                              │
│       ▼                                                             │
│  [VAE Decode] ──▶ IMAGES (향상됨)                                   │
│                      │                                              │
│                      ▼                                              │
│              [Video Combine]                                        │
│                      │                                              │
│                      ▼                                              │
│               📹 upscaled.mp4                                       │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 8. 프레임 보간

### 8.1 RIFE (Real-Time Intermediate Flow Estimation)

8fps → 24fps/30fps 변환

```
┌─────────────────────────────────────────────────────────────────────┐
│                    RIFE 프레임 보간                                  │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│   원본: 8 FPS                                                       │
│   ┌───┬───┬───┬───┬───┬───┬───┬───┐                               │
│   │ 1 │ 2 │ 3 │ 4 │ 5 │ 6 │ 7 │ 8 │  (1초 = 8프레임)              │
│   └───┴───┴───┴───┴───┴───┴───┴───┘                               │
│                     │                                               │
│                     ▼  RIFE 보간 (×3)                              │
│                                                                     │
│   결과: 24 FPS                                                      │
│   ┌─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┐              │
│   │1│•│•│2│•│•│3│•│•│4│•│•│5│•│•│6│•│•│7│•│•│8│•│•│              │
│   └─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┘              │
│                                                                     │
│   • = 보간된 프레임 (AI 생성)                                        │
│                                                                     │
│   VRAM 사용: ~2GB                                                   │
│   속도: ~30fps 실시간 처리                                           │
└─────────────────────────────────────────────────────────────────────┘
```

### 8.2 ComfyUI 노드

```
[Load Video] ──▶ [RIFE VFI] ──▶ [Video Combine]
                     │
                     ├── multiplier: 3 (8fps → 24fps)
                     ├── model: rife47 (최신)
                     └── ensemble: true (품질↑)
```

---

# Part 2: 웹 기반 통합 시스템

---

## 9. 명명 규칙

### 9.1 파일 명명 규칙

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           파일 명명 규칙                                     │
└─────────────────────────────────────────────────────────────────────────────┘

형식: {YYYYMMDD}_{projectName}_{type}_{index}.{ext}

예시:
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│  클립 파일:                                                                  │
│  • 20250205_myFirstProject_clip_001.mp4                                    │
│  • 20250205_myFirstProject_clip_002.mp4                                    │
│  • 20250205_catWalkingVideo_clip_001.mp4                                   │
│                                                                             │
│  썸네일:                                                                     │
│  • 20250205_myFirstProject_thumb_001.jpg                                   │
│  • 20250205_myFirstProject_thumb_002.jpg                                   │
│                                                                             │
│  병합 파일:                                                                  │
│  • 20250205_myFirstProject_merged_001.mp4                                  │
│                                                                             │
│  업스케일 파일:                                                              │
│  • 20250205_myFirstProject_upscaled_001.mp4                                │
│                                                                             │
│  프레임 보간 파일:                                                           │
│  • 20250205_myFirstProject_interpolated_001.mp4                            │
│                                                                             │
│  최종 출력:                                                                  │
│  • 20250205_myFirstProject_final_001.mp4                                   │
│                                                                             │
│  참조 이미지:                                                                │
│  • 20250205_myFirstProject_ref_001.png                                     │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 9.2 파일 타입별 접미사

| 타입 | 접미사 | 예시 |
|------|--------|------|
| 생성 클립 | `_clip_` | `20250205_projectName_clip_001.mp4` |
| 썸네일 | `_thumb_` | `20250205_projectName_thumb_001.jpg` |
| 참조 이미지 | `_ref_` | `20250205_projectName_ref_001.png` |
| 병합 영상 | `_merged_` | `20250205_projectName_merged_001.mp4` |
| 업스케일 | `_upscaled_` | `20250205_projectName_upscaled_001.mp4` |
| 프레임 보간 | `_interpolated_` | `20250205_projectName_interpolated_001.mp4` |
| 최종 출력 | `_final_` | `20250205_projectName_final_001.mp4` |

### 9.3 프로젝트명 변환 규칙

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        프로젝트명 변환 규칙                                   │
└─────────────────────────────────────────────────────────────────────────────┘

사용자 입력              →        저장용 이름 (카멜 케이스)
─────────────────────────────────────────────────────────────
"My First Project"      →        myFirstProject
"고양이 산책 영상"        →        고양이산책영상 (한글은 공백 제거)
"Cat Walking Video"     →        catWalkingVideo
"2024 Summer Trip"      →        2024SummerTrip
"test project #1"       →        testProject1 (특수문자 제거)
```

---

## 10. 웹 시스템 아키텍처

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              사용자 브라우저                                  │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                     Next.js Frontend (React)                        │   │
│  │   ┌──────────┐   ┌──────────┐   ┌──────────┐   ┌──────────┐       │   │
│  │   │ 클립생성  │   │ 클립관리  │   │ 편집/병합 │   │ 최종출력  │       │   │
│  │   └────┬─────┘   └────┬─────┘   └────┬─────┘   └────┬─────┘       │   │
│  └────────┼──────────────┼──────────────┼──────────────┼──────────────┘   │
└───────────┼──────────────┼──────────────┼──────────────┼──────────────────┘
            │              │              │              │
            ▼              ▼              ▼              ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                      Next.js API Routes (Backend)                           │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                          /api/* Endpoints                           │   │
│  └────────┬───────────────────┬────────────────┬────────────┬─────────┘   │
│           │                   │                │            │              │
│           ▼                   ▼                ▼            ▼              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │              Prisma ORM + MariaDB (videoGeneratorDb)                │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│           │                                                                 │
│           ▼                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                   BullMQ Job Queue (Redis 기반)                      │   │
│  │   ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐          │   │
│  │   │ generate │  │  merge   │  │ upscale  │  │interpolate│          │   │
│  │   │  Worker  │  │  Worker  │  │  Worker  │  │  Worker  │          │   │
│  │   └────┬─────┘  └────┬─────┘  └────┬─────┘  └────┬─────┘          │   │
│  └────────┼─────────────┼─────────────┼─────────────┼─────────────────┘   │
│           └─────────────┴──────┬──────┴─────────────┘                      │
│                                │                                            │
│                                ▼                                            │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                  ComfyUI Engine (localhost:8188)                    │   │
│  │                       RTX 3080 Ti 12GB                              │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
└───────────┬─────────────────────────────────┬───────────────────────────────┘
            │                                 │
            ▼                                 ▼
┌───────────────────────────┐   ┌───────────────────────────┐
│  MariaDB (videoGeneratorDb)│   │   File Storage (Local)    │
│                           │   │                           │
│  Tables (카멜 케이스):      │   │  명명 규칙:                │
│  • projects               │   │  {날짜}_{프로젝트}_{타입}   │
│  • clips                  │   │                           │
│  • jobs                   │   │  예: 20250205_myProject   │
│  • jobLogs                │   │      _clip_001.mp4        │
└───────────────────────────┘   └───────────────────────────┘
```

---

## 11. 기술 스택

### 11.1 통합 스택 (Next.js 풀스택)

| 구분 | 기술 | 선택 이유 |
|------|------|----------|
| **Frontend** | Next.js 14 (App Router) | React 기반, SSR/SSG |
| **Backend** | Next.js API Routes | 프론트와 동일 코드베이스, 간소화 |
| **Database** | MariaDB | MySQL 호환, 안정성, 성능 |
| **ORM** | Prisma | 타입 안전성, MariaDB 지원 |
| **작업 큐** | BullMQ + Redis | 장시간 GPU 작업 처리 |
| **파일 저장** | 로컬 or MinIO | 영상 파일 저장 |
| **실시간** | Socket.io / Server-Sent Events | 진행률 업데이트 |
| **AI 엔진** | ComfyUI API | 영상 생성 |

### 11.2 Frontend 라이브러리

| 구분 | 기술 | 용도 |
|------|------|------|
| **스타일링** | TailwindCSS | 빠른 UI 개발 |
| **상태관리** | Zustand | 간단하고 가벼움 |
| **서버상태** | TanStack Query | 캐싱, 자동 갱신 |
| **비디오** | Video.js | 미리보기 플레이어 |
| **드래그앤드롭** | dnd-kit | 클립 순서 변경 |

### 11.3 명명 규칙 요약

| 구분 | 기술 | 명명 규칙 |
|------|------|----------|
| **Frontend** | Next.js 14 | 컴포넌트: PascalCase |
| **Backend** | Next.js API Routes | API: /api/camelCase |
| **Database** | MariaDB | DB명: videoGeneratorDb |
| **ORM** | Prisma | 필드: camelCase |
| **작업 큐** | BullMQ + Redis | Queue명: camelCase |
| **파일명** | - | {날짜}_{프로젝트}_{타입} |

---

## 12. 데이터베이스 스키마

### 12.1 데이터베이스명

```
Database: videoGeneratorDb
```

### 12.2 테이블 구조

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    MariaDB Schema (카멜 케이스)                              │
└─────────────────────────────────────────────────────────────────────────────┘

┌──────────────────┐       ┌──────────────────┐       ┌──────────────────┐
│     projects     │       │      clips       │       │      jobs        │
├──────────────────┤       ├──────────────────┤       ├──────────────────┤
│ id               │───┐   │ id               │   ┌───│ id               │
│ projectName      │   │   │ projectId        │◀──┤   │ projectId        │
│ displayName      │   └──▶│ clipName         │   │   │ jobType          │
│ description      │       │ orderIndex       │   │   │ inputClipIds     │
│ resolution       │       │ prompt           │   │   │ jobSettings      │
│ frameRate        │       │ negativePrompt   │   │   │ outputPath       │
│ projectStatus    │       │ seedValue        │   │   │ outputFileName   │
│ createdAt        │       │ stepsCount       │   │   │ progressPercent  │
│ updatedAt        │       │ cfgScale         │   │   │ jobStatus        │
└──────────────────┘       │ referenceImage   │   │   │ errorMessage     │
                           │ ipAdapterWeight  │   │   │ startedAt        │
                           │ filePath         │   │   │ completedAt      │
                           │ fileName         │   │   │ createdAt        │
                           │ thumbnailPath    │   │   └──────────────────┘
                           │ thumbnailName    │   │
                           │ durationSec      │   │
                           │ frameCount       │   │
                           │ clipStatus       │   │
                           │ createdAt        │   │
                           │ updatedAt        │   │
                           └──────────────────┘   │
                                                  │
                           ┌──────────────────┐   │
                           │    jobLogs       │   │
                           ├──────────────────┤   │
                           │ id               │   │
                           │ jobId            │◀──┘
                           │ logLevel         │
                           │ logMessage       │
                           │ createdAt        │
                           └──────────────────┘
```

### 12.3 테이블별 상세 필드

#### projects 테이블

| 필드명 | 타입 | 설명 |
|--------|------|------|
| `id` | CHAR(36) | UUID, PK |
| `projectName` | VARCHAR(100) | 저장용 이름 (카멜케이스) |
| `displayName` | VARCHAR(255) | 사용자 표시용 이름 |
| `description` | TEXT | 프로젝트 설명 |
| `resolution` | VARCHAR(20) | "512x512", "768x768" |
| `frameRate` | INT | 기본 8 |
| `projectStatus` | VARCHAR(50) | draft, active, archived |
| `createdAt` | DATETIME | 생성일시 |
| `updatedAt` | DATETIME | 수정일시 |

#### clips 테이블

| 필드명 | 타입 | 설명 |
|--------|------|------|
| `id` | CHAR(36) | UUID, PK |
| `projectId` | CHAR(36) | FK → projects |
| `clipName` | VARCHAR(255) | 클립 이름 |
| `orderIndex` | INT | 병합 순서 |
| `prompt` | TEXT | 생성 프롬프트 |
| `negativePrompt` | TEXT | 네거티브 프롬프트 |
| `seedValue` | BIGINT | 시드값 |
| `stepsCount` | INT | 스텝 수 |
| `cfgScale` | FLOAT | CFG 스케일 |
| `referenceImage` | VARCHAR(500) | 참조 이미지 경로 |
| `ipAdapterWeight` | FLOAT | IP어댑터 가중치 |
| `filePath` | VARCHAR(500) | 영상 파일 전체 경로 |
| `fileName` | VARCHAR(255) | 영상 파일명 |
| `thumbnailPath` | VARCHAR(500) | 썸네일 전체 경로 |
| `thumbnailName` | VARCHAR(255) | 썸네일 파일명 |
| `durationSec` | FLOAT | 영상 길이 (초) |
| `frameCount` | INT | 프레임 수 |
| `clipStatus` | VARCHAR(50) | pending, processing, completed, failed |
| `createdAt` | DATETIME | 생성일시 |
| `updatedAt` | DATETIME | 수정일시 |

#### jobs 테이블

| 필드명 | 타입 | 설명 |
|--------|------|------|
| `id` | CHAR(36) | UUID, PK |
| `projectId` | CHAR(36) | FK → projects |
| `jobType` | VARCHAR(50) | generate, merge, upscale, interpolate, export |
| `inputClipIds` | JSON | 입력 클립 ID 배열 |
| `jobSettings` | JSON | 작업별 설정 |
| `outputPath` | VARCHAR(500) | 출력 파일 전체 경로 |
| `outputFileName` | VARCHAR(255) | 출력 파일명 |
| `progressPercent` | TINYINT | 0-100 |
| `jobStatus` | VARCHAR(50) | pending, processing, completed, failed, cancelled |
| `errorMessage` | TEXT | 에러 메시지 |
| `startedAt` | DATETIME | 시작일시 |
| `completedAt` | DATETIME | 완료일시 |
| `createdAt` | DATETIME | 생성일시 |

#### jobLogs 테이블

| 필드명 | 타입 | 설명 |
|--------|------|------|
| `id` | INT | Auto Increment, PK |
| `jobId` | CHAR(36) | FK → jobs |
| `logLevel` | VARCHAR(20) | info, warn, error, debug |
| `logMessage` | TEXT | 로그 메시지 |
| `createdAt` | DATETIME | 생성일시 |

---

## 13. API 설계

### 13.1 API 엔드포인트 구조

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    API Routes (카멜 케이스 적용)                             │
└─────────────────────────────────────────────────────────────────────────────┘

/api
│
├── /projects
│   ├── GET     /                       # 프로젝트 목록
│   ├── POST    /                       # 프로젝트 생성
│   ├── GET     /[projectId]            # 프로젝트 상세
│   ├── PATCH   /[projectId]            # 프로젝트 수정
│   └── DELETE  /[projectId]            # 프로젝트 삭제
│
├── /clips
│   ├── GET     /                       # 클립 목록 (?projectId=xxx)
│   ├── POST    /generateClip           # 클립 생성 요청
│   ├── GET     /[clipId]               # 클립 상세
│   ├── PATCH   /[clipId]               # 클립 수정
│   ├── DELETE  /[clipId]               # 클립 삭제
│   └── PATCH   /reorderClips           # 순서 변경
│
├── /jobs
│   ├── POST    /mergeClips             # 병합 작업
│   ├── POST    /upscaleVideo           # 업스케일 작업
│   ├── POST    /interpolateFrames      # 프레임 보간
│   ├── GET     /[jobId]                # 작업 상태
│   └── DELETE  /[jobId]                # 작업 취소
│
├── /export
│   └── POST    /exportFinal            # 최종 출력
│
└── /events
    └── GET     /jobProgress/[jobId]    # SSE 진행률
```

### 13.2 요청/응답 예시

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      API 요청/응답 예시                                      │
└─────────────────────────────────────────────────────────────────────────────┘

POST /api/clips/generateClip
Request:
{
  "projectId": "uuid-xxx",
  "clipName": "인트로 장면",
  "generationType": "textToVideo",
  "prompt": "a cat walking...",
  "negativePrompt": "blurry...",
  "clipSettings": {
    "stepsCount": 20,
    "cfgScale": 7.5,
    "seedValue": -1,
    "frameCount": 16
  }
}

Response:
{
  "clipId": "uuid-yyy",
  "jobId": "uuid-zzz",
  "fileName": "20250205_myFirstProject_clip_001.mp4",
  "jobStatus": "pending",
  "estimatedTime": 60
}
```

---

## 14. 파일 저장 구조

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                     파일 저장 구조 (명명 규칙 적용)                           │
└─────────────────────────────────────────────────────────────────────────────┘

storage/
│
├── clips/
│   └── {projectName}/
│       ├── 20250205_myFirstProject_clip_001.mp4
│       ├── 20250205_myFirstProject_clip_002.mp4
│       └── 20250206_myFirstProject_clip_003.mp4
│
├── thumbnails/
│   └── {projectName}/
│       ├── 20250205_myFirstProject_thumb_001.jpg
│       ├── 20250205_myFirstProject_thumb_002.jpg
│       └── 20250206_myFirstProject_thumb_003.jpg
│
├── referenceImages/
│   └── {projectName}/
│       ├── 20250205_myFirstProject_ref_001.png
│       └── 20250205_myFirstProject_ref_002.png
│
├── processing/
│   └── {projectName}/
│       ├── 20250205_myFirstProject_merged_001.mp4
│       ├── 20250205_myFirstProject_upscaled_001.mp4
│       └── 20250205_myFirstProject_interpolated_001.mp4
│
└── exports/
    └── {projectName}/
        ├── 20250205_myFirstProject_final_001.mp4
        └── 20250206_myFirstProject_final_002.mp4
```

---

## 15. 데이터 흐름

### 15.1 클립 생성 흐름

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                     클립 생성 + 파일명 생성 흐름                              │
└─────────────────────────────────────────────────────────────────────────────┘

  브라우저                    Next.js API                    Worker
     │                           │                             │
     │  1. POST /api/clips/generateClip                        │
     │  {projectId, prompt, ...} │                             │
     │ ─────────────────────────▶│                             │
     │                           │                             │
     │                           │  2. 프로젝트 정보 조회        │
     │                           │     (projectName 획득)       │
     │                           │                             │
     │                           │  3. 파일명 생성              │
     │                           │     ┌────────────────────┐  │
     │                           │     │ 날짜: 20250205     │  │
     │                           │     │ 프로젝트: myProject│  │
     │                           │     │ 타입: clip         │  │
     │                           │     │ 인덱스: 001        │  │
     │                           │     │ ─────────────────  │  │
     │                           │     │ 결과:              │  │
     │                           │     │ 20250205_myProject │  │
     │                           │     │ _clip_001.mp4      │  │
     │                           │     └────────────────────┘  │
     │                           │                             │
     │                           │  4. DB에 clip 레코드 생성    │
     │                           │     (fileName 포함)         │
     │                           │                             │
     │                           │  5. Queue에 작업 등록        │
     │                           │ ───────────────────────────▶│
     │                           │                             │
     │  6. {clipId, fileName}    │                             │
     │◀───────────────────────── │                             │
     │                           │                             │
     │                           │                 7. ComfyUI 호출
     │                           │                    영상 생성
     │                           │                             │
     │                           │                 8. 파일 저장 │
     │                           │                    (생성된 fileName으로)
     │                           │                             │
     │  9. 완료 알림              │                             │
     │◀─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─│◀─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ │
```

### 15.2 최종 출력 파이프라인

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      최종 출력 파일명 생성 흐름                               │
└─────────────────────────────────────────────────────────────────────────────┘

  요청: POST /api/export/exportFinal
  {
    "projectId": "uuid-xxx",
    "clipIds": ["uuid-1", "uuid-2", "uuid-3"],
    "pipelineSettings": {...}
  }
        │
        ▼
  ┌─────────────────────────────────────────────────────────────────────┐
  │                    각 단계별 파일명 생성                              │
  │                                                                     │
  │   Step 1: Merge                                                    │
  │   ┌─────────────────────────────────────────────────────────────┐  │
  │   │ 입력: clip_001.mp4, clip_002.mp4, clip_003.mp4              │  │
  │   │ 출력: 20250205_myProject_merged_001.mp4                     │  │
  │   └─────────────────────────────────────────────────────────────┘  │
  │                          │                                         │
  │                          ▼                                         │
  │   Step 2: Upscale                                                  │
  │   ┌─────────────────────────────────────────────────────────────┐  │
  │   │ 입력: 20250205_myProject_merged_001.mp4                     │  │
  │   │ 출력: 20250205_myProject_upscaled_001.mp4                   │  │
  │   └─────────────────────────────────────────────────────────────┘  │
  │                          │                                         │
  │                          ▼                                         │
  │   Step 3: Interpolate                                              │
  │   ┌─────────────────────────────────────────────────────────────┐  │
  │   │ 입력: 20250205_myProject_upscaled_001.mp4                   │  │
  │   │ 출력: 20250205_myProject_interpolated_001.mp4               │  │
  │   └─────────────────────────────────────────────────────────────┘  │
  │                          │                                         │
  │                          ▼                                         │
  │   Step 4: Final Encode                                             │
  │   ┌─────────────────────────────────────────────────────────────┐  │
  │   │ 입력: 20250205_myProject_interpolated_001.mp4               │  │
  │   │ 출력: 20250205_myProject_final_001.mp4                      │  │
  │   └─────────────────────────────────────────────────────────────┘  │
  │                                                                     │
  └─────────────────────────────────────────────────────────────────────┘
```

---

## 16. 디렉토리 구조

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    Next.js 프로젝트 디렉토리 구조                             │
└─────────────────────────────────────────────────────────────────────────────┘

videoGenerator/
│
├── app/
│   ├── (pages)/
│   │   ├── projects/
│   │   ├── projects/[projectId]/
│   │   ├── projects/[projectId]/clips/
│   │   ├── projects/[projectId]/editClips/
│   │   └── projects/[projectId]/exportVideo/
│   │
│   ├── api/
│   │   ├── projects/
│   │   │   ├── route.ts
│   │   │   └── [projectId]/route.ts
│   │   ├── clips/
│   │   │   ├── route.ts
│   │   │   ├── [clipId]/route.ts
│   │   │   ├── generateClip/route.ts
│   │   │   └── reorderClips/route.ts
│   │   ├── jobs/
│   │   │   ├── [jobId]/route.ts
│   │   │   ├── mergeClips/route.ts
│   │   │   ├── upscaleVideo/route.ts
│   │   │   └── interpolateFrames/route.ts
│   │   ├── export/
│   │   │   └── exportFinal/route.ts
│   │   └── events/
│   │       └── jobProgress/[jobId]/route.ts
│   │
│   └── layout.tsx
│
├── components/
│   ├── clipGenerator/
│   ├── clipManager/
│   ├── videoEditor/
│   ├── exportPanel/
│   └── ui/
│
├── lib/
│   ├── prismaClient.ts
│   ├── comfyuiClient.ts
│   ├── jobQueue.ts
│   ├── fileStorage.ts
│   ├── fileNaming.ts              # 파일명 생성 유틸
│   └── ffmpegWrapper.ts
│
├── workers/
│   ├── generateWorker.ts
│   ├── mergeWorker.ts
│   ├── upscaleWorker.ts
│   └── interpolateWorker.ts
│
├── prisma/
│   └── schema.prisma
│
├── types/
│   ├── clipTypes.ts
│   ├── jobTypes.ts
│   └── projectTypes.ts
│
├── public/
│   └── storage/                   # 정적 파일 서빙
│       ├── clips/
│       ├── thumbnails/
│       ├── referenceImages/
│       ├── processing/
│       └── exports/
│
├── docker-compose.yml
└── package.json
```

---

## 17. Docker 구성

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          Docker Compose 구성                                │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│  nextjsApp      │     │  workerProcess  │     │  comfyuiEngine  │
│  :3000          │     │  (BullMQ)       │     │  :8188          │
│                 │     │                 │     │                 │
│  • Frontend     │     │  • 작업 처리     │     │  • AI 엔진      │
│  • API Routes   │     │  • 파일명 생성   │     │  • GPU 연결     │
└────────┬────────┘     └────────┬────────┘     └────────┬────────┘
         │                       │                       │
         └───────────────────────┼───────────────────────┘
                                 │
         ┌───────────────────────┼───────────────────────┐
         │                       │                       │
         ▼                       ▼                       ▼
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│ mariadbServer   │     │  redisServer    │     │  storageVolume  │
│ :3306           │     │  :6379          │     │                 │
│                 │     │                 │     │  /storage/      │
│ DB:             │     │  • jobQueue     │     │  ├── clips/     │
│ videoGeneratorDb│     │  • cache        │     │  ├── thumbnails/│
│                 │     │                 │     │  └── exports/   │
└─────────────────┘     └─────────────────┘     └─────────────────┘

서비스 포트:
• nextjsApp: 3000 (웹 앱 + API)
• mariadbServer: 3306 (데이터베이스)
• redisServer: 6379 (작업 큐)
• comfyuiEngine: 8188 (AI 엔진)
```

---

## 18. 설치 가이드

### 18.1 사전 요구사항

- **OS**: Windows 10/11, Linux
- **GPU**: NVIDIA RTX 3080 Ti 12GB
- **CUDA**: 11.8+ (권장 12.1)
- **Python**: 3.10+
- **Node.js**: 18+
- **Docker**: 설치 필요
- **저장 공간**: 30GB+

### 18.2 ComfyUI 설치 단계

```bash
# 1. ComfyUI 클론
git clone https://github.com/comfyanonymous/ComfyUI.git
cd ComfyUI

# 2. 가상환경 생성 및 활성화
python -m venv venv
source venv/bin/activate  # Linux
# venv\Scripts\activate   # Windows

# 3. PyTorch 설치 (CUDA 12.1)
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu121

# 4. ComfyUI 의존성 설치
pip install -r requirements.txt

# 5. 확장 노드 설치
cd custom_nodes
git clone https://github.com/Kosinkadink/ComfyUI-AnimateDiff-Evolved.git
git clone https://github.com/Kosinkadink/ComfyUI-VideoHelperSuite.git
git clone https://github.com/cubiq/ComfyUI_IPAdapter_plus.git
git clone https://github.com/ltdrdata/ComfyUI-Manager.git
```

### 18.3 웹 시스템 설치

```bash
# 1. 프로젝트 생성
npx create-next-app@latest videoGenerator --typescript --tailwind --app

# 2. 의존성 설치
cd videoGenerator
npm install prisma @prisma/client bullmq ioredis

# 3. Prisma 초기화
npx prisma init

# 4. Docker 실행
docker-compose up -d
```

### 18.4 최적화 설정

```bash
# ComfyUI 실행 (3080 Ti 권장)
python main.py --highvram --fp16

# 환경 변수
export PYTORCH_CUDA_ALLOC_CONF=max_split_size_mb:512
```

---

## 19. 모델 다운로드 링크

### 19.1 필수 모델

| 모델 | 용량 | 저장 위치 | 다운로드 |
|------|------|----------|----------|
| **SD 1.5 체크포인트** | ~2GB | `models/checkpoints/` | [HuggingFace](https://huggingface.co/runwayml/stable-diffusion-v1-5) |
| **RealisticVision v5.1** | 2.1GB | `models/checkpoints/` | [CivitAI](https://civitai.com/models/4201/realistic-vision-v51) |
| **AnimateDiff v2** | 1.5GB | `custom_nodes/ComfyUI-AnimateDiff-Evolved/models/` | [HuggingFace](https://huggingface.co/guoyww/animatediff/tree/main) |
| **VAE** | 300MB | `models/vae/` | [HuggingFace](https://huggingface.co/stabilityai/sd-vae-ft-mse-original) |

### 19.2 IPAdapter 모델

| 모델 | 용량 | 저장 위치 | 다운로드 |
|------|------|----------|----------|
| **ip-adapter_sd15** | 44MB | `models/ipadapter/` | [HuggingFace](https://huggingface.co/h94/IP-Adapter/tree/main/models) |
| **ip-adapter-plus_sd15** | 98MB | `models/ipadapter/` | [HuggingFace](https://huggingface.co/h94/IP-Adapter/tree/main/models) |
| **CLIP Image Encoder** | 2.5GB | `models/clip_vision/` | [HuggingFace](https://huggingface.co/h94/IP-Adapter/tree/main/models/image_encoder) |

### 19.3 업스케일 모델

| 모델 | 용량 | 저장 위치 | 다운로드 |
|------|------|----------|----------|
| **RealESRGAN_x4plus** | 64MB | `models/upscale_models/` | [GitHub](https://github.com/xinntao/Real-ESRGAN/releases) |
| **RealESRGAN_x4plus_anime_6B** | 64MB | `models/upscale_models/` | [GitHub](https://github.com/xinntao/Real-ESRGAN/releases) |

### 19.4 프레임 보간 모델

| 모델 | 용량 | 저장 위치 | 다운로드 |
|------|------|----------|----------|
| **RIFE v4.7** | 30MB | `custom_nodes/ComfyUI-Frame-Interpolation/models/` | [GitHub](https://github.com/hzwer/Practical-RIFE/releases) |

---

## 20. 구현 우선순위

| 단계 | 구현 항목 | 예상 기간 |
|------|----------|----------|
| **Phase 1** | 프로젝트 셋업 + 파일명 유틸 | 2-3일 |
| **Phase 2** | Prisma 스키마 (카멜케이스) + MariaDB | 1일 |
| **Phase 3** | 클립 생성 API + ComfyUI 연동 | 1주 |
| **Phase 4** | BullMQ 워커 + 진행률 SSE | 3일 |
| **Phase 5** | Frontend UI | 1주 |
| **Phase 6** | 병합 + 업스케일 + 보간 | 1주 |
| **Phase 7** | 최종 출력 파이프라인 | 3일 |
| **Phase 8** | 테스트 + 폴리싱 | 1주 |

**총 예상 기간: 5-6주**

---

## 📝 예상 결과물 스펙

### 생성 시간

| 설정 | 프레임 | 예상 시간 | 결과물 |
|------|--------|----------|--------|
| 512×512, 16f, 20steps | 16 | ~45초 | 2초 영상 |
| 512×512, 24f, 20steps | 24 | ~70초 | 3초 영상 |
| 512×512, 32f, 25steps | 32 | ~120초 | 4초 영상 |

### 최종 출력 예시

| 단계 | 해상도 | FPS | 길이 |
|------|--------|-----|------|
| 원본 클립 1~3 | 512×512 | 8 | 각 3초 |
| 이어붙이기 후 | 512×512 | 8 | 9초 |
| 업스케일 후 | 2048×2048 | 8 | 9초 |
| 프레임 보간 후 | 2048×2048 | 24 | 9초 |
| **최종 출력** | **2048×2048** | **24** | **9초** |

---

## 📄 문서 정보

- **작성일**: 2025년 2월 5일
- **대상 GPU**: RTX 3080 Ti 12GB
- **기술 스택**: Next.js + MariaDB + ComfyUI
- **파일 명명**: {날짜}_{프로젝트명}_{타입}_{인덱스}
- **DB 명명**: 카멜 케이스 (camelCase)

---

> 💡 **팁**: ComfyUI Manager를 사용하면 대부분의 확장 노드와 모델을 GUI에서 쉽게 설치할 수 있습니다.
